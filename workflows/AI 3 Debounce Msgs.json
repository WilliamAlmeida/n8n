{
  "active": false,
  "connections": {
    "get msgs": {
      "main": [
        [
          {
            "node": "has msgs?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "delete msgs": {
      "main": [
        [
          {
            "node": "Sort by Timestamp",
            "type": "main",
            "index": 0
          },
          {
            "node": "delete debounce 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get debounce": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "has msgs?": {
      "main": [
        [
          {
            "node": "delete msgs",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "delete debounce",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "get reading chats?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "messages": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "chatInfo": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "now",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "get chats 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "chatInfo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get chats": {
      "main": [
        [
          {
            "node": "has chats?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get chats 2": {
      "main": [
        [
          {
            "node": "has chats? 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items 2": {
      "main": [
        [
          {
            "node": "reset reading chats 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "chatInfo 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "chatInfo 2": {
      "main": [
        [
          {
            "node": "get msgs 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get msgs 2": {
      "main": [
        [
          {
            "node": "has msgs? 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "has msgs? 2": {
      "main": [
        [
          {
            "node": "Loop Over Items 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "delete chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "has chats? 2": {
      "main": [
        [
          {
            "node": "Loop Over Items 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "has chats?": {
      "main": [
        [
          {
            "node": "set reading chats",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "deactivate debounce",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "deactivate debounce": {
      "main": [
        [
          {
            "node": "delete wk debounce",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort by Timestamp": {
      "main": [
        [
          {
            "node": "messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "now": {
      "main": [
        [
          {
            "node": "get debounce",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "delete chat": {
      "main": [
        [
          {
            "node": "Loop Over Items 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "get chats 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get msgs",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reset chats": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "has chats?1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get chats1": {
      "main": [
        [
          {
            "node": "has chats?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "reset chats",
            "type": "main",
            "index": 0
          },
          {
            "node": "delete msgs1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "get chats1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get reading chats?": {
      "main": [
        [
          {
            "node": "reading chat?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reading chat?": {
      "main": [
        [
          {
            "node": "Reading Chat",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get chats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set reading chats": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "delete wk debounce": {
      "main": [
        [
          {
            "node": "reset reading chats",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Execute Workflow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "delete debounce": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reset reading chats": {
      "main": [
        [
          {
            "node": "End Debounce",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-09-26T15:44:44.997Z",
  "id": "KCzwyXp5E0KjdlRc",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "AI 3 Debounce Msgs",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "seconds",
              "secondsInterval": 5
            }
          ]
        }
      },
      "id": "49ea90a0-4fa1-4431-a4c8-4b6450d9c5c1",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -3440,
        2000
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "msgs",
        "key": "=msgs_{{ $('chatInfo').first().json.unique_id }}",
        "keyType": "list",
        "options": {}
      },
      "id": "2bbdcd77-1076-4fe7-96d4-1ea10d8c5a96",
      "name": "get msgs",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1540,
        2020
      ],
      "alwaysOutputData": true,
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=msgs_{{ $('chatInfo').first().json.unique_id }}"
      },
      "id": "2eebc120-0bbb-45b8-b215-6ef4ca4281bd",
      "name": "delete msgs",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1200,
        1900
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=debounce_{{ $('chatInfo').first().json.unique_id }}"
      },
      "id": "d3a4eafa-0d92-4fb2-a3d2-b0df25f75b98",
      "name": "delete debounce",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1200,
        2060
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "debounce",
        "key": "=debounce_{{ $('chatInfo').first().json.unique_id }}",
        "keyType": "string",
        "options": {}
      },
      "id": "73cece30-6c79-4a07-a6d1-b220baa9eee2",
      "name": "get debounce",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1940,
        2020
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "698fdd1c-49fd-4e0a-b418-c21417923e8a",
              "leftValue": "={{ $json.msgs }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "123fdf34-05f7-4876-b9d4-6ee793c4ba57",
      "name": "has msgs?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1380,
        2020
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "BZ9o5Ey8QpAJn1OB",
          "mode": "list",
          "cachedResultName": "AI 4 Process Message"
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "id": "f6d57b96-6072-481b-8a88-f776aef54775",
      "name": "Execute Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        -660,
        2080
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8666de43-4b2b-4e75-8506-9b106f1a626c",
              "name": "conversation",
              "value": "={{ $json.msgs.map(item => JSON.parse(item).output).join('\\n') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "1faef3c5-37ae-42b9-b1fb-7ddc7c6c9286",
      "name": "messages",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -840,
        1900
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n.wmst.com.br/webhook-test/425a712d-f598-4e72-a99e-65efb704c401",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.chat }}",
        "options": {}
      },
      "id": "db1234dd-8e3f-4568-b04f-19e960c8da51",
      "name": "WK Process Msg",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -300,
        1360
      ],
      "disabled": true
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ $json.values().first() }}",
        "options": {}
      },
      "id": "f47bdda4-6997-427d-82fe-9291bce18fc8",
      "name": "chatInfo",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2260,
        2020
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "2169479c-70a5-432f-ac40-f9419e651264",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2440,
        2000
      ]
    },
    {
      "parameters": {
        "operation": "keys",
        "keyPattern": "chat_*"
      },
      "id": "5cd2ac05-e7be-497c-b282-2d26cef0490d",
      "name": "get chats",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2940,
        2020
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "keys",
        "keyPattern": "chat_*"
      },
      "id": "cf830bf1-62a0-4d72-b75f-268810e01904",
      "name": "get chats 2",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1940,
        1540
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "a3f17cf9-6969-4088-84dc-288a0491090a",
      "name": "Loop Over Items 2",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1560,
        1520
      ]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ $json.values().first() }}",
        "options": {}
      },
      "id": "5d87fc0c-13b9-4fcd-9000-cee5b6661fd4",
      "name": "chatInfo 2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1380,
        1540
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "msgs",
        "key": "=msgs_{{ $('chatInfo').first().json.unique_id }}",
        "keyType": "list",
        "options": {}
      },
      "id": "0d40ac24-bf44-4c1f-ab55-52684240e9c7",
      "name": "get msgs 2",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1220,
        1540
      ],
      "alwaysOutputData": true,
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "698fdd1c-49fd-4e0a-b418-c21417923e8a",
              "leftValue": "={{ $json.msgs }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5550c056-770d-47c1-9582-13c06bb25f97",
      "name": "has msgs? 2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1060,
        1540
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=chat_{{ $('chatInfo').first().json.unique_id }}"
      },
      "id": "82a60ef2-a95a-4caf-90d7-4b9512c18ef4",
      "name": "delete chat",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -880,
        1560
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "698fdd1c-49fd-4e0a-b418-c21417923e8a",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "230c5092-feb2-4812-85c9-fbc15e5de337",
      "name": "has chats? 2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1780,
        1540
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "698fdd1c-49fd-4e0a-b418-c21417923e8a",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "00b53b27-546a-4c68-aa31-d26f43715aa6",
      "name": "has chats?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2780,
        2020
      ]
    },
    {
      "parameters": {
        "operation": "deactivate",
        "workflowId": {
          "__rl": true,
          "value": "KCzwyXp5E0KjdlRc",
          "mode": "list",
          "cachedResultName": "AI 3 Debounce Msgs (#KCzwyXp5E0KjdlRc)"
        },
        "requestOptions": {}
      },
      "id": "68ff5950-0193-4592-b534-bc66877cb557",
      "name": "deactivate debounce",
      "type": "n8n-nodes-base.n8n",
      "typeVersion": 1,
      "position": [
        -2620,
        2280
      ],
      "credentials": {
        "n8nApi": {
          "id": "kuCc4NOcDaUS3bF4",
          "name": "william"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "workflow_debounce"
      },
      "id": "035f2de3-1bbe-4ab7-90f2-2a3b42854045",
      "name": "delete wk debounce",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2460,
        2280
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "function converterParaArrayJson(msgs) {\n    return msgs.map(msg => JSON.parse(msg)); // Convertendo string JSON para objeto\n}\n\nfunction ordenarPorTimestamp(msgs) {\n    return msgs.sort((a, b) => a.timestamp_local - b.timestamp_local); // Ordenando pelo timestamp\n}\n\nfunction converterParaJsonString(msgs) {\n    return msgs.map(msg => JSON.stringify(msg)); // Convertendo objetos de volta para string JSON\n}\n\nfunction processarDados(msgs) {\n    const arrayJson = converterParaArrayJson(msgs);\n    const arrayOrdenado = ordenarPorTimestamp(arrayJson);\n    return converterParaJsonString(arrayOrdenado);\n}\n\n// Supondo que msgs seja um array de strings JSON\nlet msgs = $input.item.json.msgs; // Acesso direto à array de mensagens\n\nreturn { msgs: processarDados(msgs)};"
      },
      "id": "5bcdbe0c-771d-45aa-b5a2-679c58e21c7a",
      "name": "Sort by Timestamp",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1020,
        1900
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d83b9900-325f-44d0-972b-f82607c37698",
              "name": "now",
              "value": "={{ $now.toMillis() }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "8a3ec3bd-bcec-4f72-a320-b139459e8fcf",
      "name": "now",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2100,
        2020
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.debounce }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "not started"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5aa6ed30-d48a-499c-82a9-026844311d1e",
                    "leftValue": "={{ $json.debounce?.toNumber() - $('now').first().json.now }}",
                    "rightValue": "={{ 0 }}",
                    "operator": {
                      "type": "number",
                      "operation": "lt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "continue"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "in debounce"
        }
      },
      "id": "0f2647b9-60ac-4331-a1de-33ec6f73e896",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1780,
        2020
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=chat_{{ $json.unique_id }}"
      },
      "id": "c70a0a7d-b3e2-4563-a4de-01f55520e223",
      "name": "reset chats",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1860,
        2860
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "keys",
        "keyPattern": "chat_*"
      },
      "id": "b106a402-4190-44cb-b99b-8d0d4ac9666e",
      "name": "get chats1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2800,
        2580
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "698fdd1c-49fd-4e0a-b418-c21417923e8a",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "dfd22a59-ed17-452f-8aa0-5b7b3d5116c0",
      "name": "has chats?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2640,
        2580
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "db22ad34-4434-469b-9144-33151836c6c5",
      "name": "Loop Over Items1",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2100,
        2560
      ]
    },
    {
      "parameters": {},
      "id": "e36a12b3-492d-48df-8fd7-d7587ffbeec5",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1860,
        2540
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0d781073-08e2-4b30-bdeb-fd54bc71b480",
              "name": "chats",
              "value": "={{ $json.values().map(item => JSON.parse(item)) }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "id": "5f725abe-01ff-483d-9182-0644be9d4259",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2440,
        2560
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "chats",
        "options": {}
      },
      "id": "7a8f1948-003c-41c7-aae4-1c0d3d8ca239",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2280,
        2560
      ]
    },
    {
      "parameters": {},
      "id": "3b07af88-e504-4945-a68a-4b72fe021dd3",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -2980,
        2580
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "msgs_ibox_cli_23_5512982184879"
      },
      "id": "a0249f83-2960-423c-b43f-6bccce29cef4",
      "name": "delete msgs1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1860,
        2700
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d8b38257-545d-4f4e-bb2f-5678b8d1f42c",
              "leftValue": "={{ $json.reading_chats }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9d728801-936a-4506-b998-6b37081fde07",
      "name": "reading chat?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3120,
        2000
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "reading_chats",
        "key": "reading_chats",
        "keyType": "string",
        "options": {}
      },
      "id": "eacc27d7-15bd-4822-aff7-fd947e2b49d1",
      "name": "get reading chats?",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3280,
        2000
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "set",
        "key": "reading_chats",
        "value": "1",
        "keyType": "string"
      },
      "id": "ccd248c2-56a3-4660-9642-6c522d304200",
      "name": "set reading chats",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2620,
        2000
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "reading_chats"
      },
      "id": "9aece0cc-99ed-4f22-b5de-6970a625ff13",
      "name": "reset reading chats",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2300,
        2280
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "reading_chats"
      },
      "id": "d754d560-310f-419f-9d22-40430e5da536",
      "name": "reset reading chats 2",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1380,
        1380
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "id": "d24c1097-b160-4e9d-9b6b-618d19f171d7",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        -660,
        1800
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=debounce_{{ $('chatInfo').first().json.unique_id }}"
      },
      "id": "dc1115a6-21d0-4c5d-8b68-53e0fccd2e3f",
      "name": "delete debounce 2",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1020,
        2060
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "errorMessage": "end debounce"
      },
      "id": "d161efae-3812-4cbc-bb68-a96108e8d1ef",
      "name": "End Debounce",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -2140,
        2280
      ]
    },
    {
      "parameters": {
        "errorMessage": "reading chat"
      },
      "id": "8241fa5d-a987-48d1-882b-e318f1b18441",
      "name": "Reading Chat",
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        -2940,
        1860
      ]
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    }
  },
  "tags": [
    {
      "createdAt": "2024-09-27T14:34:01.317Z",
      "updatedAt": "2024-09-27T14:34:01.317Z",
      "id": "ZoTSEGR97fzorfDz",
      "name": "AI"
    },
    {
      "createdAt": "2024-09-27T17:42:17.034Z",
      "updatedAt": "2024-09-27T17:42:17.034Z",
      "id": "TsfCA8eZuTObjOfy",
      "name": "Backup"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-10-04T04:34:13.306Z",
  "versionId": "e85cf35b-fab7-4e10-a6ef-adfaa68dba80"
}